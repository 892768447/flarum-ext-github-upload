{"version":3,"sources":["webpack://@irony/github-upload/webpack/bootstrap","webpack://@irony/github-upload/external \"flarum.core.compat['app']\"","webpack://@irony/github-upload/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@irony/github-upload/external \"flarum.core.compat['Model']\"","webpack://@irony/github-upload/external \"flarum.core.compat['extend']\"","webpack://@irony/github-upload/external \"flarum.core.compat['components/TextEditor']\"","webpack://@irony/github-upload/external \"flarum.core.compat['utils/mixin']\"","webpack://@irony/github-upload/external \"flarum.core.compat['common/Component']\"","webpack://@irony/github-upload/external \"flarum.core.compat['common/components/Button']\"","webpack://@irony/github-upload/external \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@irony/github-upload/external \"flarum.core.compat['common/utils/classList']\"","webpack://@irony/github-upload/./src/common/models/File.js","webpack://@irony/github-upload/./src/common/fileToBBcode.js","webpack://@irony/github-upload/./src/forum/components/UploadButton.js","webpack://@irony/github-upload/./src/forum/components/DragAndDrop.js","webpack://@irony/github-upload/./src/forum/handler/Uploader.js","webpack://@irony/github-upload/./src/forum/components/index.js","webpack://@irony/github-upload/./src/forum/index.js","webpack://@irony/github-upload/./src/forum/addUploadButton.js","webpack://@irony/github-upload/./forum.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","_inheritsLoose","subClass","superClass","constructor","__proto__","File","bbcode","file","type","url","fileToBBcode","this","mixin","Model","attribute","uuid","created_at","path","UploadButton","oninit","vnode","attrs","uploader","on","$","reset","redraw","oncreate","isMediaUploadButton","tooltip","view","buttonText","uploading","app","translator","trans","className","classList","icon","onclick","uploadButtonClicked","title","disabled","size","multiple","onchange","process","e","files","prop","length","upload","click","Component","DragAndDrop","composerElement","handlers","supportsFileDragging","addEventListener","out","dropping","div","document","createElement","window","unload","removeEventListener","isNotFile","event","dataTransfer","items","kind","preventDefault","over","add","remove","Uploader","callbacks","success","failure","uploaded","callback","push","dispatch","response","forEach","addBBcode","body","FormData","append","request","method","forum","serialize","raw","then","result","error","data","fileObj","store","pushObject","components","initializers","extend","TextEditor","component","f_","console","log","composer","editor","insertAtCursor","preview","originalIsFullScreen","isFullScreen","dragAndDrop","parents","models"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n","module.exports = flarum.core.compat['app'];","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['components/TextEditor'];","module.exports = flarum.core.compat['utils/mixin'];","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","module.exports = flarum.core.compat['common/utils/classList'];","import Model from 'flarum/Model';\nimport mixin from 'flarum/utils/mixin';\nimport fileToBBcode from '../fileToBBcode';\n\nexport default class File extends mixin(Model, {\n    url: Model.attribute('url'),\n    name: Model.attribute('name'),\n    uuid: Model.attribute('sha'),\n    type: Model.attribute('type'),\n    created_at: Model.attribute('created_at'),\n    path: Model.attribute('path'),\n}) {\n    /**\n     * Generate bbcode for this file\n     */\n    bbcode() {\n        return fileToBBcode(this);\n    }\n}\n","export default function fileToBBcode(file) {\n    switch (file.type()) {\n        // File\n        case 'file':\n            return `[${file.name()}](${file.url()})`;\n\n        // Image template\n        case 'image':\n            return `[IMG]${file.url()}[/IMG]`;\n\n        // video\n        case 'audio':\n            return `[AUDIO]${file.url()}[/AUDIO]`;\n\n        // video\n        case 'video':\n            return `[VIDEO]${file.url()}[/VIDEO]`;\n\n        // 'just-url' or unknown\n        default:\n            return `[${file.name()}](${file.url()})`;\n    }\n}\n","import app from 'flarum/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport classList from 'flarum/common/utils/classList';\n\nexport default class UploadButton extends Component {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.attrs.uploader.on('uploaded', () => {\n            // reset the button for a new upload\n            this.$('form')[0].reset();\n\n            // redraw to reflect uploader.loading in the DOM\n            m.redraw();\n        });\n    }\n\n    oncreate(vnode) {\n        super.oncreate(vnode);\n\n        // Add tooltip\n        if (!this.isMediaUploadButton) {\n            this.$().tooltip();\n        }\n    }\n\n    view() {\n        const buttonText = this.attrs.uploader.uploading\n            ? app.translator.trans('flarum-ext-github-upload.forum.states.loading')\n            : app.translator.trans('flarum-ext-github-upload.forum.buttons.attach');\n\n        /**\n         * Flarum core has decided that all buttons should have tooltips, but\n         * it uses `extractText` to get a title attr when none is provided.\n         *\n         * That returns `false` when no text is available, like the icon in a\n         * button.\n         *\n         * This means that it starts creating weird tooltips, such as `falsefalse`\n         * and `falseUpload`.\n         *\n         * To override this behaviour, we pass `\" \"` when no tooltip is desired.\n         * Using `\"\"` won't work as JS interprets this as a falsey value which will\n         * trigger the core logic.\n         *\n         * Thankfully, browsers ignore title attributes made of only whitespace,\n         * preventing a ghost-like tooltip.\n         */\n        const tooltip = (!this.isMediaUploadButton && buttonText) || ' ';\n\n        return (\n            <Button\n                className={classList([\n                    'Button',\n                    'hasIcon',\n                    'irony-github-upload-button',\n                    !this.isMediaUploadButton && !this.attrs.uploader.uploading && 'Button--icon',\n                    !this.isMediaUploadButton && !this.attrs.uploader.uploading && 'Button--link',\n                    this.attrs.uploader.uploading && 'uploading',\n                ])}\n                icon={!this.attrs.uploader.uploading && 'fas fa-cloud-upload-alt'}\n                onclick={this.uploadButtonClicked.bind(this)}\n                title={tooltip}\n                disabled={this.attrs.disabled}\n            >\n                {this.attrs.uploader.uploading &&\n                <LoadingIndicator size=\"tiny\" className=\"LoadingIndicator--inline Button-icon\"/>}\n                {(this.isMediaUploadButton || this.attrs.uploader.uploading) &&\n                <span className=\"Button-label\">{buttonText}</span>}\n                <form>\n                    <input type=\"file\" multiple={true} onchange={this.process.bind(this)}/>\n                </form>\n            </Button>\n        );\n    }\n\n    /**\n     * Process the upload event.\n     *\n     * @param e\n     */\n    process(e) {\n        // get the file from the input field\n        const files = this.$('input').prop('files');\n\n        if (files.length === 0) {\n            // We've got no files to upload, so trying\n            // to begin an upload will show an error\n            // to the user.\n            return;\n        }\n\n        this.attrs.uploader.upload(files, !this.isMediaUploadButton);\n    }\n\n    /**\n     * Event handler for upload button being clicked\n     *\n     * @param {PointerEvent} e\n     */\n    uploadButtonClicked(e) {\n        // Trigger click on hidden input element\n        // (Opens file dialog)\n        this.$('input').click();\n    }\n}\n","export default class DragAndDrop {\n    constructor(upload, composerElement) {\n        this.upload = upload;\n        this.composerElement = composerElement;\n\n        // Keep references to the bound methods so we can remove the event listeners later\n        this.handlers = {};\n\n        if (!this.supportsFileDragging()) {\n            return;\n        }\n\n        this.composerElement.addEventListener('dragover', (this.handlers.in = this.in.bind(this)));\n\n        this.composerElement.addEventListener('dragleave', (this.handlers.out = this.out.bind(this)));\n        this.composerElement.addEventListener('dragend', this.handlers.out);\n\n        this.composerElement.addEventListener('drop', (this.handlers.dropping = this.dropping.bind(this)));\n    }\n\n    supportsFileDragging() {\n        // Based on https://css-tricks.com/drag-and-drop-file-uploading/\n        const div = document.createElement('div');\n\n        return ('draggable' in div || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\n    }\n\n    unload() {\n        // If the handlers were not set (drag and drop not supported), we skip removing them\n        if (!this.handlers.in) {\n            return;\n        }\n\n        this.composerElement.removeEventListener('dragover', this.handlers.in);\n\n        this.composerElement.removeEventListener('dragleave', this.handlers.out);\n        this.composerElement.removeEventListener('dragend', this.handlers.out);\n\n        this.composerElement.removeEventListener('drop', this.handlers.dropping);\n    }\n\n    isNotFile(event) {\n        // Checking event.dataTransfer.files.length does not work on dragover event, it's always zero\n        // So we use the dataTransfer.items property to check whether any file is being dragged\n        if (event.dataTransfer.items) {\n            for (let i = 0; i < event.dataTransfer.items.length; i++) {\n                if (event.dataTransfer.items[i].kind !== 'file') {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    in(event) {\n        if (this.isNotFile(event)) {\n            return;\n        }\n\n        event.preventDefault();\n\n        if (!this.over) {\n            this.composerElement.classList.add('fof-upload-dragging');\n            this.over = true;\n        }\n    }\n\n    out(event) {\n        if (this.isNotFile(event)) {\n            return;\n        }\n\n        event.preventDefault();\n\n        if (this.over) {\n            this.composerElement.classList.remove('fof-upload-dragging');\n            this.over = false;\n        }\n    }\n\n    dropping(event) {\n        if (this.isNotFile(event)) {\n            return;\n        }\n\n        event.preventDefault();\n\n        this.upload(event.dataTransfer.files);\n\n        this.composerElement.classList.remove('fof-upload-dragging');\n    }\n}\n","export default class Uploader {\n    constructor() {\n        this.callbacks = {\n            success: [],\n            failure: [],\n            uploading: [],\n            uploaded: [],\n        };\n        this.uploading = false;\n    }\n\n    on(type, callback) {\n        this.callbacks[type].push(callback);\n    }\n\n    dispatch(type, response) {\n        this.callbacks[type].forEach((callback) => callback(response));\n    }\n\n    upload(files, addBBcode = true) {\n        this.uploading = true;\n        this.dispatch('uploading', files);\n\n        m.redraw(); // Forcing a redraw so that the button also updates if uploadFiles() is called from DragAndDrop or PasteClipboard\n\n        const body = new FormData();\n\n        for (let i = 0; i < files.length; i++) {\n            body.append('files[]', files[i]);\n        }\n\n        // send a POST request to the api\n        return app\n            .request({\n                method: 'POST',\n                url: app.forum.attribute('apiUrl') + '/irony/github/upload',\n                // prevent JSON.stringify'ing the form data in the XHR call\n                serialize: (raw) => raw,\n                body,\n            })\n            .then((result) => this.uploaded(result, addBBcode))\n            .catch((error) => {\n                this.uploading = false;\n                m.redraw();\n\n                throw error;\n            });\n    }\n\n    uploaded(result, addBBcode = false) {\n        this.uploading = false;\n\n        result.data.forEach((file) => {\n            const fileObj = app.store.pushObject(file);\n\n            // Dispatch\n            this.dispatch('success', {\n                file: fileObj,\n                addBBcode,\n            });\n        });\n\n        this.dispatch('uploaded');\n    }\n}\n","import Uploader from '../handler/Uploader';\nimport DragAndDrop from './DragAndDrop';\n\nexport const components = {\n    DragAndDrop,\n    Uploader,\n};\n","import app from 'flarum/app';\n\nimport File from '../common/models/File';\nimport addUploadButton from './addUploadButton';\n\nexport * from './components';\n\napp.initializers.add('irony-github-upload', app => {\n    addUploadButton();\n    // File model\n    app.store.models.files = File;\n});\n","import app from 'flarum/app';\nimport {extend} from 'flarum/extend';\nimport TextEditor from 'flarum/components/TextEditor';\nimport UploadButton from './components/UploadButton';\nimport DragAndDrop from './components/DragAndDrop';\nimport PasteClipboard from './components/PasteClipboard';\nimport Uploader from './handler/Uploader';\n\nexport default function () {\n    extend(TextEditor.prototype, 'oninit', function () {\n        this.uploader = new Uploader();\n    });\n    extend(TextEditor.prototype, 'controlItems', function (items) {\n        if (!app.forum.attribute('canUploadToGithub')) return;\n\n        // Add upload button\n        items.add(\n            'irony-github-upload',\n            UploadButton.component({\n                uploader: this.uploader,\n            })\n        );\n\n    });\n\n    extend(TextEditor.prototype, 'oncreate', function (f_, vnode) {\n        if (!app.forum.attribute('canUploadToGithub')) return;\n\n        this.uploader.on('success', ({file, addBBcode}) => {\n            console.log(file);\n            if (!addBBcode || !file.url()) return;\n\n            this.attrs.composer.editor.insertAtCursor(file.bbcode() + '\\n');\n\n            // We wrap this in a typeof check to prevent it running when a user\n            // is creating a new discussion. There's nothing to preview in a new\n            // discussion, so the `preview` function isn't defined.\n            if (typeof this.attrs.preview === 'function') {\n                // Scroll the preview into view\n                // preview() causes the composer to close on mobile, but we don't want that. We want only the scroll\n                // We work around that by temporarily patching the isFullScreen method\n                const originalIsFullScreen = app.composer.isFullScreen;\n\n                app.composer.isFullScreen = () => false;\n\n                this.attrs.preview();\n\n                app.composer.isFullScreen = originalIsFullScreen;\n            }\n        });\n\n        const dragAndDrop = new DragAndDrop((files) => this.uploader.upload(files), this.$().parents('.Composer')[0]);\n\n        const unloadHandler = () => {\n            dragAndDrop.unload();\n        };\n\n        this.$('textarea').bind('onunload', unloadHandler);\n\n        //new PasteClipboard((files) => this.uploader.upload(files), this.$('textarea')[0]);\n    });\n}\n","export * from './src/forum';"],"sourceRoot":""}